---
# -------------------------------------------------------------------------------------------------------------------- #
# GENERAL
# -------------------------------------------------------------------------------------------------------------------- #

title: 'Пулы'
description: ''
icon: 'far fa-file-lines'
categories:
  - 'pool'
tags:
  - 'pool'
  - 'zpool'
  - 'add'
  - 'attach'
  - 'create'
  - 'destroy'
  - 'detach'
  - 'export'
  - 'import'
  - 'status'
  - 'upgrade'
authors:
  - 'KaiKimera'
sources:
  - ''
license: 'CC-BY-SA-4.0'
complexity: '0'
toc: 1
comments: 1

# -------------------------------------------------------------------------------------------------------------------- #
# DATE
# -------------------------------------------------------------------------------------------------------------------- #

date: '2025-11-19T12:30:11+03:00'
publishDate: '2025-11-19T12:30:11+03:00'
lastMod: '2025-11-19T12:30:11+03:00'

# -------------------------------------------------------------------------------------------------------------------- #
# META
# -------------------------------------------------------------------------------------------------------------------- #

type: 'articles'
hash: '4ae99a817845dc9164639584ae271ef8e0468a75'
uuid: '4ae99a81-7845-5c91-8463-9584ae271ef8'
slug: '4ae99a81-7845-5c91-8463-9584ae271ef8'

draft: 0
---

Рассмотрим различные варианты работы с пулами.

<!--more-->

## Создание пула

- Создать обычный пул `data` из одного диска `pci-0000:01:00.0-scsi-0:1:0:0`:

```bash
p='data'; d=('pci-0000:01:00.0-scsi-0:1:0:0'); o=('-o' 'ashift=12'); O=('-O' 'atime=off'); zpool create "${o[@]}" "${O[@]}" "${p}" "${d[@]}"
```

## Расширение пула

Расширение пула происходит путём добавления дополнительного диска или увеличением размера виртуального диска.

### Добавление диска в пул

- Добавить диск `pci-0000:01:00.0-scsi-0:1:1:0` в пул `data`:

```bash
p='data'; d=('pci-0000:01:00.0-scsi-0:1:1:0'); zpool add "${p}" "${d[@]}"
```

### Расширение диска в пуле

- Обновить информацию об устройстве `sdb`, на котором располагается пул `data` и расширить его:

```bash
p='data'; b='sdb'; d=('pci-0000:03:00.0-scsi-0:1:0:0'); echo 1 > "/sys/block/${b}/device/rescan" && zpool online -e "${p}" "${d[@]}"
```

{{< alert "tip" >}}
При необходимости можно включить автоматическое расширение пула `data`:

```bash
p='data'; o=('-o' 'autoexpand=on'); zpool set "${o[@]}" "${p}"
```
{{< /alert >}}

## Подключение и отключение дисков

Подключение и отключение дисков осуществляются командами `attach` и `detach`, соответственно.

### Подключение второго диска (для создания зеркала)

- Подключить новый диск `pci-0000:03:00.0-scsi-0:1:1:0` к существующему диску `pci-0000:03:00.0-scsi-0:1:0:0` в пуле `data` для создания зеркала:

```bash
p='data'; d=('pci-0000:03:00.0-scsi-0:1:0:0' 'pci-0000:03:00.0-scsi-0:1:1:0'); zpool attach "${p}" "${d[@]}"
```

### Отключение второго диска

- Отключить диск `pci-0000:03:00.0-scsi-0:1:1:0` в пуле `data`:

```bash
p='data'; d=('pci-0000:03:00.0-scsi-0:1:1:0'); zpool detach "${p}" "${d[@]}"
```

## Экспортирование пула

- Экспортировать все пулы:

```bash
zpool export -a
```

- Экспортировать пул `data`:

```bash
p='data'; zpool export "${p}"
```

## Импортирование пула

- Посмотреть список пулов для импорта:

```bash
zpool import
```

- Импортировать пул `data`:

```bash
p='data'; zpool import "${p}"
```

- Импортировать пул `data` с новым именем `data_NEW`:

```bash
p=('data' 'data_NEW'); zpool import "${p[@]}"
```

- Импортировать пул `data`, состоящий из дисков `pci-0000:01:00.0-scsi-0:1:0:0` и `pci-0000:01:00.0-scsi-0:1:1:0`:

```bash
p='data'; d=('-d' 'pci-0000:01:00.0-scsi-0:1:0:0' '-d' 'pci-0000:01:00.0-scsi-0:1:1:0'); zpool import "${d[@]}" "${p}"
```

- ...или можно разрешить {{< tag "ZFS" >}} автоматически поискать диски пула `data`:

```bash
p='data'; d=('-d' '/dev/disk/by-path/'); zpool import "${d[@]}" "${p}"
```

## Переименования пула

- Экспортировать пул `data`:

```bash
p='data'; zpool export "${p}"
```

- Импортировать пул `data` с новым именем `data_NEW`:

```bash
p=('data' 'data_NEW'); zpool import "${p[@]}"
```

## Обновление пула

- Проверить необходимость обновления пула `data`:

```bash
zpool status -v
```

- При появлении надписи `status: Some supported features are not enabled on the pool...` запустить обновление пула `data`:

```bash
p='data'; zpool upgrade "${p}"
```

- ...или обновить сразу все пулы:

```bash
zpool upgrade -a
```

## Удаление пула

- Удалить пул `data`:

```bash
p='data'; zpool destroy "${p}"
```

## Восстановление пула

- Показать список уничтоженных пулов:

```bash
zpool import -D
```

- Восстановить уничтоженный пул `data`:

```bash
p='data'; zpool import -D "${p}"
```

## Список пулов

Вывести список всех пулов в системе:

```bash
zpool list
```

## Статус пула

- Проверить статус пула `data`:

```bash
p='data'; zpool status -v "${p}"
```

## Свойства пула

- Показать все свойства всех пулов:

```bash
zpool get all
```

- Показать все свойства пула `data`:

```bash
p='data'; zpool get all "${p}"
```

- Показать свойства `autoexpand`, `ashift` и `fragmentation` всех пулов:

```bash
o=('autoexpand' 'ashift' 'fragmentation'); zpool get "$( echo "${o[@]}" | tr ' ' ',' )"
```

- Показать свойства `autoexpand`, `ashift` и `fragmentation` пула `data`:

```bash
p='data'; o=('autoexpand' 'ashift' 'fragmentation'); zpool get "$( echo "${o[@]}" | tr ' ' ',' )" "${p}"
```

- Установить свойство `autoexpand` в `on` пула `data`:

```bash
p='data'; o=('-o' 'autoexpand=on'); zpool set "${o[@]}" "${p}"
```
